import{u as U,g as Z,h as ee,i as Y,j as te,k as se,t as ae,l as le,m as S,n as F,p as re,q as z,s,v as oe,R as $,x as ie,y as ue,z as ne,A as O,B as I,C as ce,D as pe,E as de,F as ve,O as ge,G as he,H as me,P as ye,I as Ee,J as fe,K as H}from"./app-D0gXOH81.js";const Be=["/","/home.html","/posts/english/That's%20Why%20(You%20Go%20Away).html","/posts/interview/","/posts/knowledge-reserve/","/posts/knowledge-reserve/collect-note.html","/posts/knowledge-reserve/emoji.html","/posts/knowledge-reserve/microservices.html","/posts/ops/","/posts/ops/deploy.html","/posts/ops/fio.html","/posts/ops/github-actions.html","/posts/ops/linux.html","/posts/ops/wsl2.html","/posts/question/","/posts/question/article-1.html","/posts/question/article-3.html","/posts/question/article-4.html","/posts/question/article-5.html","/posts/question/article-8.html","/posts/question/gitalk.html","/posts/question/nginx.html","/posts/question/prometheus.html","/posts/coding-related/datasource/alter-column.html","/posts/coding-related/datasource/mysql.html","/posts/coding-related/datasource/redis.html","/posts/coding-related/datasource/tls10.html","/posts/coding-related/java/design_patterns.html","/posts/coding-related/java/juc.html","/posts/coding-related/java/jvm.html","/posts/coding-related/java/note_first.html","/posts/coding-related/java/prometheus.html","/posts/coding-related/java/type.html","/posts/coding-related/rust/rust_course_01.html","/posts/coding-related/rust/rust_course_02.html","/posts/coding-related/spring/spring.html","/posts/coding-related/typescript/electron-base.html","/posts/knowledge-reserve/redis/redis-base.html","/404.html","/posts/english/","/posts/","/posts/coding-related/datasource/","/posts/coding-related/","/posts/coding-related/java/","/posts/coding-related/rust/","/posts/coding-related/spring/","/posts/coding-related/typescript/","/posts/knowledge-reserve/redis/","/category/","/category/english/","/category/%E9%9D%A2%E8%AF%95/","/category/%E6%94%B6%E8%97%8F/","/category/%E8%BF%90%E7%BB%B4/","/category/%E7%BC%96%E7%A8%8B/","/category/%E9%97%AE%E9%A2%98/","/category/%E7%9B%91%E6%8E%A7/","/category/sql/","/tag/","/tag/java/","/tag/spring/","/tag/redis/","/tag/mq/","/tag/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/","/tag/mysql/","/tag/%E5%88%86%E5%B8%83%E5%BC%8F/","/tag/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/","/tag/%E8%BD%AF%E4%BB%B6/","/tag/%E6%94%B6%E8%97%8F%E7%BD%91%E5%9D%80/","/tag/docker/","/tag/fio/","/tag/io/","/tag/github/","/tag/linux/","/tag/vim/","/tag/wsl2/","/tag/spring-boot/","/tag/quartz/","/tag/druid/","/tag/gitalk/","/tag/nginx/","/tag/prometheus/","/tag/fastjson/","/tag/sql/","/tag/%E6%95%B0%E6%8D%AE%E5%BA%93/","/tag/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/","/tag/grafana/","/tag/%E5%8F%8D%E5%B0%84/","/tag/rust/","/tag/electron/","/tag/react/","/tag/typescript/","/tag/antd/","/tag/node/","/article/","/star/","/timeline/"],qe="SEARCH_PRO_QUERY_HISTORY",g=U(qe,[]),Ae=()=>{const{queryHistoryCount:a}=H,l=a>0;return{enabled:l,queryHistory:g,addQueryHistory:r=>{l&&(g.value.length<a?g.value=Array.from(new Set([r,...g.value])):g.value=Array.from(new Set([r,...g.value.slice(0,a-1)])))},removeQueryHistory:r=>{g.value=[...g.value.slice(0,r),...g.value.slice(r+1)]}}},_=a=>Be[a.id]+("anchor"in a?`#${a.anchor}`:""),ke="SEARCH_PRO_RESULT_HISTORY",{resultHistoryCount:b}=H,h=U(ke,[]),we=()=>{const a=b>0;return{enabled:a,resultHistory:h,addResultHistory:l=>{if(a){const r={link:_(l),display:l.display};"header"in l&&(r.header=l.header),h.value.length<b?h.value=[r,...h.value]:h.value=[r,...h.value.slice(0,b-1)]}},removeResultHistory:l=>{h.value=[...h.value.slice(0,l),...h.value.slice(l+1)]}}},He=a=>{const l=ce(),r=Y(),R=pe(),i=S(!1),E=de([]);return ve(()=>{const{search:q,terminate:m}=ge(),A=()=>{E.value=[],i.value=!1},f=fe(c=>{const B=c.join(" "),{searchFilter:x=v=>v,splitWord:C,suggestionsFilter:L,...y}=l.value;i.value=!0,B?q(c.join(" "),r.value,y).then(v=>x(v,B,r.value,R.value)).then(v=>{E.value=v,i.value=!1}).catch(v=>{console.error(v),A()}):A()},H.searchDelay-H.suggestDelay);z([a,r],([c])=>f(c),{immediate:!0}),he(()=>{m()})}),{searching:i,results:E}};var xe=Z({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(a,{emit:l}){const r=ee(),R=Y(),i=te(se),{enabled:E,addQueryHistory:q,queryHistory:m,removeQueryHistory:A}=Ae(),{enabled:f,resultHistory:c,addResultHistory:B,removeResultHistory:x}=we(),C=E||f,L=ae(a,"queries"),{results:y,searching:v}=He(L),o=le({isQuery:!0,index:0}),p=S(0),d=S(0),T=F(()=>C&&(m.value.length>0||c.value.length>0)),Q=F(()=>y.value.length>0),D=F(()=>y.value[p.value]||null),G=()=>{const{isQuery:e,index:t}=o;t===0?(o.isQuery=!e,o.index=e?c.value.length-1:m.value.length-1):o.index=t-1},M=()=>{const{isQuery:e,index:t}=o;t===(e?m.value.length-1:c.value.length-1)?(o.isQuery=!e,o.index=0):o.index=t+1},J=()=>{p.value=p.value>0?p.value-1:y.value.length-1,d.value=D.value.contents.length-1},K=()=>{p.value=p.value<y.value.length-1?p.value+1:0,d.value=0},V=()=>{d.value<D.value.contents.length-1?d.value+=1:K()},W=()=>{d.value>0?d.value-=1:J()},j=e=>e.map(t=>me(t)?t:s(t[0],t[1])),N=e=>{if(e.type==="customField"){const t=ye[e.index]||"$content",[u,w=""]=Ee(t)?t[R.value].split("$content"):t.split("$content");return e.display.map(n=>s("div",j([u,...n,w])))}return e.display.map(t=>s("div",j(t)))},k=()=>{p.value=0,d.value=0,l("updateQuery",""),l("close")};return re("keydown",e=>{if(a.isFocusing){if(Q.value){if(e.key==="ArrowUp")W();else if(e.key==="ArrowDown")V();else if(e.key==="Enter"){const t=D.value.contents[d.value];q(a.queries.join(" ")),B(t),r.push(_(t)),k()}}else if(f){if(e.key==="ArrowUp")G();else if(e.key==="ArrowDown")M();else if(e.key==="Enter"){const{index:t}=o;o.isQuery?(l("updateQuery",m.value[t]),e.preventDefault()):(r.push(c.value[t].link),k())}}}}),z([p,d],()=>{var e;(e=document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>s("div",{class:["search-pro-result-wrapper",{empty:a.queries.length?!Q.value:!T.value}],id:"search-pro-results"},a.queries.length?v.value?s(oe,{hint:i.value.searching}):Q.value?s("ul",{class:"search-pro-result-list"},y.value.map(({title:e,contents:t},u)=>{const w=p.value===u;return s("li",{class:["search-pro-result-list-item",{active:w}]},[s("div",{class:"search-pro-result-title"},e||i.value.defaultTitle),t.map((n,X)=>{const P=w&&d.value===X;return s($,{to:_(n),class:["search-pro-result-item",{active:P,"aria-selected":P}],onClick:()=>{q(a.queries.join(" ")),B(n),k()}},()=>[n.type==="text"?null:s(n.type==="title"?ie:n.type==="heading"?ue:ne,{class:"search-pro-result-type"}),s("div",{class:"search-pro-result-content"},[n.type==="text"&&n.header?s("div",{class:"content-header"},n.header):null,s("div",N(n))])])})])})):i.value.emptyResult:C?T.value?[E?s("ul",{class:"search-pro-result-list"},s("li",{class:"search-pro-result-list-item"},[s("div",{class:"search-pro-result-title"},i.value.queryHistory),m.value.map((e,t)=>s("div",{class:["search-pro-result-item",{active:o.isQuery&&o.index===t}],onClick:()=>{l("updateQuery",e)}},[s(O,{class:"search-pro-result-type"}),s("div",{class:"search-pro-result-content"},e),s("button",{class:"search-pro-remove-icon",innerHTML:I,onClick:u=>{u.preventDefault(),u.stopPropagation(),A(t)}})]))])):null,f?s("ul",{class:"search-pro-result-list"},s("li",{class:"search-pro-result-list-item"},[s("div",{class:"search-pro-result-title"},i.value.resultHistory),c.value.map((e,t)=>s($,{to:e.link,class:["search-pro-result-item",{active:!o.isQuery&&o.index===t}],onClick:()=>{k()}},()=>[s(O,{class:"search-pro-result-type"}),s("div",{class:"search-pro-result-content"},[e.header?s("div",{class:"content-header"},e.header):null,s("div",e.display.map(u=>j(u)).flat())]),s("button",{class:"search-pro-remove-icon",innerHTML:I,onClick:u=>{u.preventDefault(),u.stopPropagation(),x(t)}})]))])):null]:i.value.emptyHistory:i.value.emptyResult)}});export{xe as default};
