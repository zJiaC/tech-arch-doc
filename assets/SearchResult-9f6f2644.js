import{a as M,b as j,n as O,c as V,m as W,l as _,d as z,y as B,h as K,e as N,f as T,r as L,g as X,i as Y,L as Z,H as ee}from"./app-97781cd7.js";import{c as te,D as ae,J as se,r as g,h as w,w as x,j as t,R as Q,G as le,i as re}from"./framework-c981031b.js";const ue="search-pro-result-history",c=M(ue,[]),ne=()=>{const{resultHistoryCount:r}=L,o=r>0;return{enabled:o,resultHistory:c,addResultHistory:l=>{o&&(c.value.length<r?c.value=[l,...c.value]:c.value=[l,...c.value.slice(0,r-1)])},removeResultHistory:l=>{c.value=[...c.value.slice(0,l),...c.value.slice(l+1)]}}},ce=r=>{const o=j(),l=g(!1),h=g([]);let i;const v=T(d=>{l.value=!0,i==null||i.terminate(),d?(i=new Worker(`/tech-arch-doc/${L.worker}`,{}),i.addEventListener("message",({data:f})=>{h.value=f,l.value=!1}),i.postMessage({query:d,routeLocale:o.value})):(h.value=[],l.value=!1)},L.delay);return x([r,o],()=>v(r.value),{immediate:!0}),{searching:l,results:h}};var ve=te({name:"SearchResult",props:{query:{type:String,required:!0}},emits:["close","updateQuery"],setup(r,{emit:o}){const l=X(),h=ae(),i=j(),v=O(Y),{addQueryHistory:d}=Z(),{enabled:f,resultHistory:b,addResultHistory:q,removeResultHistory:A}=ne(),$=se(r,"query"),{results:y,searching:E}=ce($),u=g(0),s=g(0),D=w(()=>b.value.length>0),R=w(()=>y.value.length>0),H=w(()=>y.value[u.value]||null),U=()=>{u.value=u.value>0?u.value-1:y.value.length-1,s.value=H.value.contents.length-1},F=()=>{u.value=u.value<y.value.length-1?u.value+1:0,s.value=0},G=()=>{s.value<H.value.contents.length-1?s.value=s.value+1:F()},I=()=>{s.value>0?s.value=s.value-1:U()},C=e=>e.map(a=>re(a)?a:t(a[0],a[1])),S=e=>{if(e.type==="custom"){const a=ee[e.index]||"$content",[p,m=""]=le(a)?a[i.value].split("$content"):a.split("$content");return C([p,...e.display,m])}return C(e.display)},k=()=>{u.value=0,s.value=0,o("updateQuery",""),o("close")};return V("keydown",e=>{if(R.value){if(e.key==="ArrowUp")I();else if(e.key==="ArrowDown")G();else if(e.key==="Enter"){const a=H.value.contents[s.value];l.value.path!==a.path&&(d(r.query),q(a),h.push(a.path),k())}}}),x([u,s],()=>{var e;(e=document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>t("div",{class:["search-pro-result",{empty:$.value?!R.value:!D.value}],id:"search-pro-results"},$.value===""?D.value?t("ul",{class:"search-pro-result-list"},t("li",{class:"search-pro-result-list-item"},[t("div",{class:"search-pro-result-title"},v.value.history),b.value.map((e,a)=>t(Q,{to:e.path,class:["search-pro-result-item",{active:s.value===a}],onClick:()=>{k()}},()=>[t(W,{class:"search-pro-result-type"}),t("div",{class:"search-pro-result-content"},[e.type==="content"&&e.header?t("div",{class:"content-header"},e.header):null,t("div",S(e))]),t("button",{class:"search-pro-close-icon",onClick:p=>{p.preventDefault(),p.stopPropagation(),A(a)}},t(_))]))])):f?v.value.emptyHistory:v.value.emptyResult:E.value?t(z,{hint:v.value.searching}):R.value?t("ul",{class:"search-pro-result-list"},y.value.map(({title:e,contents:a},p)=>{const m=u.value===p;return t("li",{class:["search-pro-result-list-item",{active:m}]},[t("div",{class:"search-pro-result-title"},e||"Documentation"),a.map((n,J)=>{const P=m&&s.value===J;return t(Q,{to:n.path,class:["search-pro-result-item",{active:P,"aria-selected":P}],onClick:()=>{d(r.query),q(n),k()}},()=>[n.type==="content"?null:t(n.type==="title"?B:n.type==="heading"?K:N,{class:"search-pro-result-type"}),t("div",{class:"search-pro-result-content"},[n.type==="content"&&n.header?t("div",{class:"content-header"},n.header):null,t("div",S(n))])])})])})):v.value.emptyResult)}});export{ve as default};
